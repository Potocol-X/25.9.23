<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>923.birthday20</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- 引入 Phaser（CDN） -->
  <script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.js"></script>
  <style>html,body,#game{height:100%;margin:0;background:#111;}</style>
</head>
<body>
  <div id="game"></div>
  <script>
    class LockScene extends Phaser.Scene {
      constructor(){ super('L'); }

        preload(){
            this.load.image('lockwall', 'assets/lockwall.png');
        }

        create(){

            this.bg = this.add.image(0, 0, 'lockwall').setOrigin(0.5,0.5);
            this.fitBgToCanvas(this.scale.gameSize.width, this.scale.gameSize.height);
            this.scale.on('resize', (gameSize) => {
                this.fitBgToCanvas(gameSize.width, gameSize.height);
            });

            // --- 1) 电脑端：Enter ---
            this.enterKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ENTER);

            // --- 2) 手机端：上划手势检测 ---
            this.swipeStartY = null;
            this.swipeStartT = 0;

            // 按下时记录起点与时间
            this.input.on('pointerdown', (p)=>{
            this.swipeStartY = p.y;
            this.swipeStartT = this.time.now;
            });

            // 抬起时判断是否为“上划”
            this.input.on('pointerup', (p)=>{
            if (this._triggered) return; // 防多次触发
            if (this.swipeStartY == null) return;

            const dy = p.y - this.swipeStartY;     // 负值表示向上
            const dt = this.time.now - this.swipeStartT;
            const DIST = 60;   // 最小距离阈值（像素）
            const TIME = 600;  // 最大时间阈值（毫秒）

            if (dy < -DIST && dt < TIME) {
                this.goNext();
            }
            this.swipeStartY = null;
            });
        }

        fitBgToCanvas(canvasW, canvasH){
            // 原图尺寸
            const tex = this.textures.get('lockwall').getSourceImage();
            const imgW = tex.width;
            const imgH = tex.height;

            // 按比例“容纳”在画布内（letterbox）
            const scale = Math.min(canvasW / imgW, canvasH / imgH);

            this.bg.setDisplaySize(imgW*scale, imgH*scale);
            this.bg.setPosition(canvasW / 2, canvasH / 2);
        }

        update(){
            if (Phaser.Input.Keyboard.JustDown(this.enterKey)) {
            this.goNext();
            }
        }

        goNext(){
            this._triggered = true;
            this.scene.start('P');
        }
    }

    class PWScene extends Phaser.Scene {
        constructor(){ super('P'); }

        preload(){
            this.load.image('pwscreen', 'assets/pwscreen.png');
        }

        create(){
            this.bg = this.add.image(0, 0, 'pwscreen').setOrigin(0.5,0.5);
            this.fitBgToCanvas(this.scale.gameSize.width, this.scale.gameSize.height);
            this.scale.on('resize', (gameSize) => {
                this.fitBgToCanvas(gameSize.width, gameSize.height);
            });

            
            this.back = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ESC);
        }

        fitBgToCanvas(canvasW, canvasH){
            // 原图尺寸
            const tex = this.textures.get('pwscreen').getSourceImage();
            const imgW = tex.width;
            const imgH = tex.height;

            // 按比例“容纳”在画布内（letterbox）
            const scale = Math.min(canvasW / imgW, canvasH / imgH);

            this.bg.setDisplaySize(imgW*scale, imgH*scale);
            this.bg.setPosition(canvasW / 2, canvasH / 2);
        }

        update(){
            if (Phaser.Input.Keyboard.JustDown(this.back)) this.scene.start('L');
        }
    }

    const config = {
        type: Phaser.AUTO,
        parent: 'game',
        width: 1179,
        height: 2556,
        scale: {
            mode: Phaser.Scale.RESIZE,   // ⭐ 自动跟随窗口大小
            autoCenter: Phaser.Scale.CENTER_BOTH
        },
        backgroundColor: '#242424',
        scene: [LockScene,PWScene],
    };

    new Phaser.Game(config);
</script>
</body>
</html>
